# 表情包管理器 - 交互优化方案

## 核心理念
**最高频操作：复制表情包** - 必须做到最快、最方便

## 一、核心交互优化

### 1.1 复制操作（最高优先级）

#### 方案一：单击即复制（推荐）
```
用户体验：
1. 单击图片 → 立即复制到剪贴板
2. 显示 Toast 提示："✅ 已复制"
3. 图片卡片闪烁一下表示已复制
4. 自动记录使用次数

优点：
- 最快速，零学习成本
- 符合"复制是最高频操作"的需求
- 一步到位

缺点：
- 无法预览大图
- 可能误触
```

#### 方案二：悬浮快捷复制按钮
```
用户体验：
1. 鼠标悬浮在图片上
2. 显示大大的"📋 复制"按钮（占据卡片中央）
3. 点击按钮即复制
4. 其他操作（标签、删除等）在右上角小图标

优点：
- 复制按钮最显眼
- 避免误触
- 保留其他操作入口

推荐：方案二
```

### 1.2 标签管理（多标签支持）

#### 快速打标签
```
交互流程：
1. 悬浮图片 → 显示标签图标
2. 点击标签图标 → 弹出标签选择器（Popover，不是 Dialog）
3. 标签选择器特点：
   - 显示所有标签（带颜色圆点）
   - 已选标签高亮显示
   - 支持多选/取消选择
   - 底部有"+ 新建标签"快捷入口
   - 点击空白处自动保存并关闭

视觉设计：
┌─────────────────────┐
│  选择标签            │
├─────────────────────┤
│ ✓ 🔴 搞笑           │
│ ✓ 🟡 可爱           │
│   🔵 工作           │
│   🟢 表情包         │
├─────────────────────┤
│ + 新建标签          │
└─────────────────────┘
```

#### 批量打标签
```
1. 选中多张图片（Shift/Cmd 多选）
2. 右键或工具栏 → "批量添加标签"
3. 弹出标签选择器
4. 选择标签后应用到所有选中图片
```

### 1.3 图片卡片简化

#### 移除不必要信息
```
移除：
- ❌ 文件大小
- ❌ 尺寸信息
- ❌ 创建时间
- ❌ 文件名（除非悬浮时显示）

保留：
- ✅ 缩略图（大而清晰）
- ✅ GIF 标识（右上角小角标）
- ✅ 使用次数（右下角，仅 > 0 时显示）
- ✅ 标签（底部显示 1-3 个彩色圆点）

卡片设计：
┌─────────────┐
│             │ ← GIF 角标
│   [图片]    │
│             │
│ 🔴🟡🔵  5次 │ ← 标签 + 使用次数
└─────────────┘
```

## 二、完整交互流程

### 2.1 主界面布局

```
┌──────────────────────────────────────────────────────────┐
│  🎭 表情包  [搜索框 Cmd+K]         [导入] [设置]          │
├─────────┬────────────────────────────────────────────────┤
│         │                                                  │
│ 📦 全部 │  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐          │
│   (120) │  │      │ │      │ │      │ │      │          │
│         │  │ 😊   │ │ 😂   │ │ 🤣   │ │ 😭   │          │
│ 🕒 最近 │  │      │ │      │ │      │ │      │          │
│         │  │🔴🟡 3│ │🟢   5│ │🔵  12│ │     1│          │
│ ⭐ 收藏 │  └──────┘ └──────┘ └──────┘ └──────┘          │
│   (15)  │                                                  │
│         │  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐          │
│ 🏷️ 标签 │  │      │ │      │ │      │ │      │          │
│ + 管理  │  │ 🎉   │ │ 👍   │ │ ❤️   │ │ 🔥   │          │
│         │  │      │ │      │ │      │ │      │          │
│ 🔴 搞笑 │  │🔴   8│ │🟡🔵 2│ │🟢🔴 6│ │     4│          │
│   (45)  │  └──────┘ └──────┘ └──────┘ └──────┘          │
│ 🟡 可爱 │                                                  │
│   (38)  │  [加载更多...]                                  │
│ 🔵 工作 │                                                  │
│   (22)  │                                                  │
│         │                                                  │
└─────────┴────────────────────────────────────────────────┘
```

### 2.2 图片卡片交互

#### 默认状态
```
┌──────────┐
│   GIF    │ ← 右上角角标（仅 GIF）
│          │
│  [图片]  │
│          │
│🔴🟡   5次│ ← 标签圆点 + 使用次数
└──────────┘
```

#### 悬浮状态
```
┌──────────┐
│   GIF  ⭐│ ← 收藏图标（已收藏则高亮）
│          │
│ ┌──────┐ │
│ │ 📋   │ │ ← 大大的复制按钮
│ │ 复制 │ │
│ └──────┘ │
│  🏷️ 🗑️  │ ← 标签、删除小图标
│🔴🟡   5次│
└──────────┘
```

#### 选中状态（批量操作）
```
┌──────────┐
│ ✓        │ ← 左上角勾选标记
│  [图片]  │
│  (变暗)  │
│🔴🟡   5次│
└──────────┘
```

### 2.3 快捷操作

#### 键盘快捷键
```
全局：
- Cmd/Ctrl + K      : 聚焦搜索
- Cmd/Ctrl + I      : 导入图片
- Cmd/Ctrl + A      : 全选
- Cmd/Ctrl + D      : 取消全选
- ESC               : 取消选择/关闭弹窗

图片操作：
- 单击              : 复制到剪贴板
- Cmd/Ctrl + 单击   : 多选
- Shift + 单击      : 范围选择
- 空格              : 预览大图
- Delete/Backspace  : 删除选中
- F                 : 收藏/取消收藏
- T                 : 打开标签选择器
```

#### 右键菜单
```
┌─────────────────┐
│ 📋 复制         │ ← 最上方，最常用
│ ⭐ 收藏         │
│ 🏷️ 添加标签     │
├─────────────────┤
│ 👁️ 预览         │
│ 📁 在文件夹显示 │
├─────────────────┤
│ 🗑️ 删除         │
└─────────────────┘
```

### 2.4 标签筛选优化

#### 侧边栏标签显示
```
🏷️ 标签
+ 管理

🔴 搞笑 (45)    ← 点击筛选
🟡 可爱 (38)    ← 支持多选（Cmd+点击）
🔵 工作 (22)
🟢 表情包 (18)
🟣 动物 (15)

[显示全部 ↓]    ← 超过 5 个折叠
```

#### 多标签筛选
```
顶部显示已选标签：
┌─────────────────────────────────┐
│ 筛选: 🔴 搞笑 × 🟡 可爱 ×      │ ← 点击 × 移除
│ [清除全部筛选]                  │
└─────────────────────────────────┘

逻辑：
- 默认：OR 关系（包含任一标签）
- Shift+点击：AND 关系（同时包含所有标签）
```

## 三、其他优化点

### 3.1 搜索优化
```
搜索框特性：
- 支持拼音搜索（已实现）
- 实时搜索（防抖 300ms）
- 搜索历史记录
- 搜索建议（标签名、常用词）

搜索结果：
- 高亮匹配关键词
- 显示匹配原因（文件名/标签）
- 按相关度排序
```

### 3.2 导入优化
```
导入方式：
1. 拖拽到窗口任意位置
2. 点击导入按钮
3. 粘贴图片（Cmd+V）
4. 从 URL 导入

导入时自动：
- 去重检测
- 智能标签建议（基于文件名）
- 批量导入进度显示
```

### 3.3 收藏功能
```
快速收藏：
- 悬浮时点击星星图标
- 快捷键 F
- 右键菜单

收藏视图：
- 侧边栏"⭐ 收藏"
- 显示所有收藏的图片
- 支持取消收藏
```

### 3.4 使用统计
```
自动记录：
- 每次复制 +1
- 每次拖拽 +1

展示：
- 卡片右下角显示次数
- "🕒 最近使用"按使用时间排序
- 可按使用次数排序
```

### 3.5 预览功能
```
触发方式：
- 按空格键
- 点击预览图标
- 双击图片（可选）

预览窗口：
┌─────────────────────────────┐
│  ← → [1/120]           × 关闭│
├─────────────────────────────┤
│                             │
│                             │
│      [大图预览]             │
│                             │
│                             │
├─────────────────────────────┤
│ 📋 复制  🏷️ 标签  🗑️ 删除  │
└─────────────────────────────┘

特性：
- 左右箭头切换
- ESC 关闭
- 底部快捷操作
- 支持 GIF 动画播放
```

## 四、视觉设计建议

### 4.1 色彩系统
```
主色调：
- 蓝色 #3b82f6（操作按钮）
- 绿色 #10b981（成功提示）
- 红色 #ef4444（删除警告）

标签颜色（预设 8 种）：
- 🔴 #ef4444 (红)
- 🟠 #f97316 (橙)
- 🟡 #eab308 (黄)
- 🟢 #22c55e (绿)
- 🔵 #3b82f6 (蓝)
- 🟣 #a855f7 (紫)
- 🟤 #92400e (棕)
- ⚫ #6b7280 (灰)
```

### 4.2 动画效果
```
微交互：
- 悬浮：轻微上浮 + 阴影
- 点击：缩放反馈
- 复制成功：卡片闪烁绿光
- 删除：淡出动画
- 标签添加：从右侧滑入

性能：
- 使用 CSS transform（GPU 加速）
- 避免 layout 抖动
- 动画时长 150-300ms
```

### 4.3 响应式
```
大屏 (>1280px): 5 列
中屏 (768-1280px): 4 列
小屏 (<768px): 3 列

卡片尺寸：
- 固定宽高比 1:1
- 最小 120px
- 最大 200px
```

## 五、实现优先级

### P0（必须实现）
1. ✅ 单击复制功能
2. ✅ 多标签支持
3. ✅ 简化卡片信息
4. ✅ 悬浮显示大复制按钮
5. ✅ 标签快速选择器

### P1（重要）
1. 收藏功能
2. 批量操作（多选、批量标签、批量删除）
3. 预览功能（空格键）
4. 右键菜单
5. 搜索优化

### P2（可选）
1. 拖拽排序
2. 自定义视图（网格大小）
3. 导出功能
4. 统计面板
5. 主题切换

## 六、技术实现要点

### 6.1 单击复制
```typescript
// AssetCard.tsx
const handleClick = async (e: React.MouseEvent) => {
  // 如果点击的是其他按钮，不触发复制
  if ((e.target as HTMLElement).closest('button')) {
    return;
  }
  
  // 复制到剪贴板
  await invoke('copy_image_to_clipboard', {
    filePath: asset.file_path
  });
  
  // 视觉反馈
  setJustCopied(true);
  setTimeout(() => setJustCopied(false), 500);
  
  // 显示 Toast
  toast.success('✅ 已复制');
  
  // 更新使用次数
  await incrementUseCount(asset.id);
};
```

### 6.2 标签选择器
```typescript
// TagSelector.tsx
<Popover>
  <PopoverTrigger>
    <IconButton icon={<TagIcon />} />
  </PopoverTrigger>
  <PopoverContent>
    <div className="tag-selector">
      {tags.map(tag => (
        <TagOption
          key={tag.id}
          tag={tag}
          selected={assetTags.includes(tag.id)}
          onToggle={() => toggleTag(tag.id)}
        />
      ))}
      <Button onClick={createNewTag}>+ 新建标签</Button>
    </div>
  </PopoverContent>
</Popover>
```

### 6.3 性能优化
```typescript
// 虚拟滚动
import { useVirtualizer } from '@tanstack/react-virtual';

// 图片懒加载
<img loading="lazy" />

// 组件 memo
export const AssetCard = memo(AssetCardComponent);

// 防抖搜索
const debouncedSearch = useMemo(
  () => debounce(search, 300),
  []
);
```

## 七、用户反馈

### 7.1 操作反馈
```
复制成功：
- Toast: "✅ 已复制"
- 卡片闪烁绿光
- 使用次数 +1

删除成功：
- Toast: "🗑️ 已删除"
- 卡片淡出动画

标签添加：
- 标签圆点从右侧滑入
- 轻微弹跳动画

错误提示：
- Toast: "❌ 操作失败: [原因]"
- 红色边框闪烁
```

### 7.2 加载状态
```
初始加载：
- 骨架屏（Skeleton）
- 加载动画

懒加载：
- 占位符渐进式加载
- 模糊到清晰过渡

批量操作：
- 进度条
- 当前处理项提示
```

## 八、总结

### 核心改进
1. **复制最方便**：单击即复制，大按钮，零学习成本
2. **多标签支持**：快速选择器，批量操作，视觉化展示
3. **界面简化**：移除无用信息，突出核心功能
4. **操作流畅**：快捷键、右键菜单、批量操作
5. **视觉反馈**：动画、Toast、状态变化

### 设计原则
- **效率优先**：最常用功能最容易触达
- **视觉清晰**：信息层次分明，避免干扰
- **操作流畅**：动画自然，反馈及时
- **容错性好**：误操作可撤销，提示清晰
- **性能优秀**：虚拟滚动，懒加载，流畅体验
