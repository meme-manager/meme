# 开发路线图

## 项目阶段

### 阶段0: 项目初始化 （进行中）

**时间**: 1周  
**状态**: 已完成

- [ ] Tauri + React 项目搭建
- [ ] Cloudflare Workers 基础设置
- [ ] pnpm workspace 配置
- [ ] ESLint + Prettier
- [ ] Git hooks (husky)
- [ ] CI/CD 基础配置

---

### 阶段1: 本地MVP功能 (进行中)

**时间**: 2-3周  
**目标**: 实现可用的本地表情包管理工具

#### 1.1 数据库和存储 🔄

- [ ] SQLite 数据库初始化
  - [ ] 创建所有表结构
  - [ ] FTS5 全文搜索表
  - [ ] 索引和触发器
- [ ] 本地文件系统结构
  - [ ] assets/ 目录（原图）
  - [ ] thumbs/ 目录（缩略图）
  - [ ] temp/ 目录（临时文件）
- [ ] 数据库迁移系统

#### 1.2 导入功能 🔄

- [ ] 拖拽导入基础框架
- [ ] 完整的导入流程
  - [ ] 文件哈希计算（去重）
  - [ ] 图片元数据读取
  - [ ] 缩略图生成（3个尺寸）
  - [ ] 数据库写入
  - [ ] FTS索引更新
- [ ] URL导入
- [ ] 剪贴板监听和导入
- [ ] 批量导入进度显示
- [ ] 错误处理和重试

#### 1.3 搜索功能

- [ ] 搜索引擎实现
  - [ ] FTS5查询封装
  - [ ] 拼音支持（pinyin-pro）
  - [ ] 查询预处理
- [ ] 搜索UI
  - [ ] 搜索框（防抖）
  - [ ] 高级筛选面板
  - [ ] 搜索历史
  - [ ] 热门搜索
- [ ] 筛选器
  - [ ] 文件类型
  - [ ] 标签
  - [ ] 集合
  - [ ] 文件大小
  - [ ] 创建时间
- [ ] 排序选项
  - [ ] 相关度
  - [ ] 创建时间
  - [ ] 使用次数
  - [ ] 文件大小

#### 1.4 UI实现

- [ ] 主布局
  - [ ] Header（搜索、导入、设置）
  - [ ] Sidebar（标签、集合、筛选）
  - [ ] MainContent（网格/列表视图）
- [ ] 资产卡片
  - [ ] 缩略图显示
  - [ ] 悬浮操作栏
  - [ ] 右键菜单
  - [ ] 信息展示
- [ ] 虚拟滚动（大量数据优化）
- [ ] 图片懒加载
- [ ] 响应式设计

#### 1.5 标签和关键词

- [ ] 标签管理
  - [ ] 创建/编辑/删除标签
  - [ ] 标签颜色选择
  - [ ] 批量添加标签
  - [ ] 标签统计
- [ ] 关键词管理
  - [ ] 添加/编辑/删除关键词
  - [ ] 关键词权重
  - [ ] 自动关键词提取（可选）
- [ ] 关联管理
  - [ ] 多选资产批量操作
  - [ ] 拖拽关联

#### 1.6 跨应用拖拽

- [ ] Tauri拖拽API封装
- [ ] macOS实现（NSPasteboard）
- [ ] Windows实现（IDataObject）
- [ ] Linux实现（X11）
- [ ] 拖拽视觉反馈
- [ ] 复制到剪贴板功能
- [ ] 使用统计记录

**里程碑**: 本地功能完整可用，可以独立使用

---

### 阶段2: 云同步功能 (计划中)

**时间**: 1-2周  
**前置**: 阶段1完成

#### 2.1 Cloudflare Workers API

- [ ] 认证系统
  - [x] 设备注册接口
  - [x] JWT token 生成
  - [ ] Token刷新
- [ ] 同步接口
  - [ ] GET /sync/pull（拉取更新）
  - [ ] POST /sync/push（推送更新）
  - [ ] 时间戳比对逻辑
  - [ ] 批量操作支持
- [ ] 资产上传
  - [ ] POST /asset/upload
  - [ ] R2直传支持
  - [ ] 缩略图上传
  - [ ] 进度回调

#### 2.2 D1数据库

- [ ] 迁移脚本
- [ ] 云端表结构
- [ ] 索引优化
- [ ] 查询性能测试

#### 2.3 R2存储

- [ ] Bucket配置
- [ ] 路径规划（/user_id/assets/）
- [ ] CORS配置
- [ ] 缓存策略

#### 2.4 客户端同步

- [ ] 同步管理器
  - [ ] 拉取更新逻辑
  - [ ] 推送更新逻辑
  - [ ] LWW冲突处理
  - [ ] 重试和错误处理
- [ ] 同步UI
  - [ ] 同步状态指示器
  - [ ] 同步进度显示
  - [ ] 冲突提示
  - [ ] 手动同步按钮
- [ ] 同步触发
  - [ ] 应用启动时
  - [ ] 定期自动同步（5分钟）
  - [ ] 网络恢复时
  - [ ] 大量操作后

#### 2.5 离线支持

- [ ] 离线检测
- [ ] 操作队列
- [ ] 网络恢复后自动同步
- [ ] 冲突队列管理

**里程碑**: 多设备数据同步功能可用

---

### 阶段3: 增强功能 (计划中)

**时间**: 1-2周

#### 3.1 集合管理

- [ ] 集合CRUD
- [ ] 资产添加到集合
- [ ] 集合内排序
- [ ] 集合图标和颜色
- [ ] 智能集合（规则筛选）

#### 3.2 分享功能

- [ ] 集合分享
  - [ ] 生成分享链接
  - [ ] Token + 过期时间
  - [ ] 分享页面（Web）
  - [ ] 访问统计
- [ ] 单个资产分享
- [ ] 分享历史

#### 3.3 使用统计

- [ ] 使用次数记录
- [ ] 最近使用列表
- [ ] 使用频率分析
- [ ] 热门表情排行

#### 3.4 全局快捷键

- [ ] 快捷键注册（Tauri）
- [ ] 全局搜索面板
- [ ] 快捷键配置
- [ ] macOS：Cmd+Shift+Space
- [ ] Windows：Ctrl+Shift+Space

#### 3.5 数据管理

- [ ] 导出数据
  - [ ] 导出为SQLite文件
  - [ ] 导出为JSON
  - [ ] 包含图片打包
- [ ] 导入数据
  - [ ] 从SQLite导入
  - [ ] 从JSON导入
  - [ ] 合并/覆盖选项
- [ ] 数据清理
  - [ ] 删除未使用的缩略图
  - [ ] 清理孤立记录
  - [ ] 数据库优化（VACUUM）

**里程碑**: 功能完整，体验优化

---

### 阶段4: 发布和优化 (计划中)

**时间**: 1-2周

#### 4.1 性能优化

- [ ] 虚拟滚动优化
- [ ] 图片缓存策略
- [ ] 数据库查询优化
- [ ] 启动时间优化
- [ ] 内存占用优化

#### 4.2 多平台适配

- [ ] macOS
  - [ ] 原生菜单栏
  - [ ] Dock图标
  - [ ] macOS风格适配
  - [ ] 代码签名
- [ ] Windows
  - [ ] 系统托盘
  - [ ] Windows风格适配
  - [ ] 安装程序
- [ ] Linux
  - [ ] .deb包
  - [ ] .AppImage
  - [ ] 桌面快捷方式

#### 4.3 测试

- [ ] 单元测试
  - [ ] 数据库操作
  - [ ] 搜索引擎
  - [ ] 同步逻辑
- [ ] E2E测试
  - [ ] 导入流程
  - [ ] 搜索流程
  - [ ] 同步流程
- [ ] 性能测试
  - [ ] 1000+资产性能
  - [ ] 搜索响应时间
  - [ ] 内存占用

#### 4.4 文档

- [ ] 用户文档
  - [ ] 快速开始
  - [ ] 功能介绍
  - [ ] 快捷键列表
  - [ ] 常见问题
- [ ] 开发文档
  - [ ] 架构说明
  - [ ] API文档
  - [ ] 贡献指南
- [ ] 发布说明
  - [ ] 版本历史
  - [ ] 更新日志

#### 4.5 发布

- [ ] GitHub Releases
- [ ] 官网（可选）
- [ ] 自动更新功能
- [ ] 使用反馈收集

**里程碑**: 正式发布 v1.0

---

## 时间线

```
Week 1-2:   阶段1.1-1.2  数据库 + 导入
Week 3-4:   阶段1.3-1.4  搜索 + UI
Week 5:     阶段1.5-1.6  标签 + 拖拽
Week 6-7:   阶段2        云同步
Week 8-9:   阶段3        增强功能
Week 10-11: 阶段4        优化和发布
```

**总计**: 11周（约3个月）

---

## 优先级

### P0 - 必须有（MVP）
- ✅ 本地数据库
- ✅ 导入功能（拖拽、URL、剪贴板）
- ✅ 搜索功能（FTS5 + 拼音）
- ✅ 基础UI（网格视图、卡片）
- ✅ 标签管理
- ✅ 跨应用拖拽

### P1 - 应该有
- 🔄 云同步
- 🔄 集合管理
- 🔄 使用统计
- 🔄 数据导入导出

### P2 - 可以有
- ⏳ 分享功能
- ⏳ 全局快捷键
- ⏳ OCR识别
- ⏳ 自动标签推荐

### P3 - 未来计划
- ⏳ 移动端（iOS/Android）
- ⏳ 浏览器插件
- ⏳ AI智能分类
- ⏳ 团队协作

---

## 当前进度

### 已完成 ✅
- 架构文档编写（简化方案）
- 文档拆分和索引
- 项目结构规划
- 清理旧代码
- 本地SQLite数据库实现
- 数据库操作封装
- Tauri后端命令实现
- 资产管理器实现
- Zustand状态管理
- 阶段0: 项目初始化 (100%)

### 进行中 🔄
- 准备开始阶段1开发

### 待开始 ⏳
- 导入功能UI
- 搜索引擎UI
- UI组件开发
- 标签管理UI
- 跨应用拖拽
- 云同步功能
- 增强功能

---

## 风险和挑战

### 技术风险

1. **跨平台拖拽兼容性**
   - 风险等级: 中
   - 缓解措施: 提前在各平台测试，准备降级方案

2. **FTS5中文搜索性能**
   - 风险等级: 低
   - 缓解措施: 优化索引，添加缓存

3. **大量图片性能问题**
   - 风险等级: 中
   - 缓解措施: 虚拟滚动、懒加载、缩略图优化

4. **同步冲突处理**
   - 风险等级: 低（个人使用）
   - 缓解措施: LWW策略，提示用户

### 时间风险

1. **跨平台测试时间不足**
   - 缓解措施: 优先支持macOS，其他平台渐进式支持

2. **功能蔓延**
   - 缓解措施: 严格遵守MVP范围，其他功能放入v2.0

---

## 下一步行动

### 本周任务 (Week 1)
1. 完成本地SQLite数据库实现
2. 实现基础的导入流程
3. 测试文件哈希去重

### 下周任务 (Week 2)
1. 完善导入功能（缩略图、元数据）
2. 开始搜索引擎开发
3. 基础UI框架搭建

### 两周后 (Week 3-4)
1. 完成搜索功能
2. UI组件开发
3. 标签管理实现

---

## 成功指标

### 技术指标
- [ ] 1000+表情包流畅运行
- [ ] 搜索响应 < 100ms
- [ ] 启动时间 < 2s
- [ ] 内存占用 < 200MB
- [ ] 同步成功率 > 99%

### 用户指标
- [ ] 导入成功率 > 95%
- [ ] 搜索准确率 > 90%
- [ ] 跨应用拖拽成功率 > 95%

### 质量指标
- [ ] 单元测试覆盖率 > 70%
- [ ] 无严重Bug
- [ ] 文档完整度 > 80%
